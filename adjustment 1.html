<!DOCTYPE html>
<html lang="en">
    <head>
    <title>INFO 5100 - Project 1 </title>
    <ul> 
        <li> 
         Jillian Beck - JLB574
        </li>
        <li> 
            Hung Ming Tseng - ht495
        </li>
        <li> 
            Peipei Duan - pd439
        </li>
    </ul>
    <script src="https://d3js.org/d3.v7.min.js"></script>
  
    <style>
    
      .legend span {
        margin-right: 10px;
      }
        
      .gridlines line {
        stroke: #bbb;
      }
      
      .gridlines .domain {
        stroke: none;
      }
      
      .axis-label {
        font-size: 12px;
        font-weight: bold;
      }
      
      .chart-title {
        font-size: 16px;
        font-weight: bold;
        text-anchor: middle;
      }
  
    </style>

</head>

<body> 

    <h3> Introduction </h3>
    <p> For our project, we intend to investigate the frequency of animal rescues within NYC Boroughs over a 5 year time frame, and the relationship between animals rescued and their respective species </p>
    
    <p>
    <svg id="graph" height="600" width="800" style="margin-top:50px"> </svg>
    
    <script> 
    d3.csv("Urban_Park_Ranger_Animal_Condition_Response_20241001.csv", d3.autoType)
    .then( (data) => {
        console.log(data);

        const svg = d3.select("#graph");
        const width = svg.attr("width");
        const height = svg.attr("height");
        const margin = { top: 50, right: 50, bottom: 70, left:70};
        const chartWidth = width - margin.left - margin.right;
        const chartHeight = height - margin.top - margin.bottom;
        const graph = svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")");
        const species = ["Birds", "Deer", "Bat", "Rat", "Squirrel", "Mouse", "Raccoon", "Snake", "Turtle", "Frog", "Fish-numerous quantity", "Raptors", "Dog", "Cat", "Rabbit"];


        let annotations = svg.append("g").attr("id","annotations");
        let chartArea = svg.append("g").attr("transform",`translate(${margin.left},${margin.top})`);  


        data.forEach(d => {
                  if (d["Animal Class"] === "Domestic") {
                      if (d["Species Description"].includes("Rabbit")) {
                          d["Animal Class"] = "Rabbit";
                      } else if (d["Species Description"].includes("Cat")) {
                          d["Animal Class"] = "Cat";
                      } else if (d["Species Description"].includes("Dog")) {
                          d["Animal Class"] = "Dog";
                      } 
                  }
              });

          
          data.forEach(d => {
                  if (d["Animal Class"] === "Terrestrial Reptile or Amphibian") { 
                      if (d["Species Description"].includes("Snake")) {
                          d["Animal Class"] = "Snake";
                      } else if (d["Species Description"].includes("Turtle")) {
                          d["Animal Class"] = "Turtle";
                      } else if (d["Species Description"].includes("Frog")) {
                          d["Animal Class"] = "Frog";
                      }
                  }
              });

            data.forEach(d => {
                  if (d["Animal Class"] === "Small Mammals - RVS") {
                      if (d["Species Description"].includes("Bat")) {
                          d["Animal Class"] = "Bat";
                      } else if (d["Species Description"].includes("Mouse")) {
                          d["Animal Class"] = "Mouse";
                      } else if (d["Species Description"].includes("Rat")) {
                          d["Animal Class"] = "Rat";
                      } else if (d["Species Description"].includes("Squirrel")) {
                          d["Animal Class"] = "Squirrel";
                      } else if (d["Species Description"].includes("Raccoon")) {
                          d["Animal Class"] = "Raccoon";
                      }
                  }
              });

              data.forEach(d => {
                  if (d["Animal Class"] === "Small Mammals - non RVS") {
                      if (d["Species Description"].includes("Bat")) {
                          d["Animal Class"] = "Bat";
                      } else if (d["Species Description"].includes("Mouse")) {
                          d["Animal Class"] = "Mouse";
                      } else if (d["Species Description"].includes("Rat")) {
                          d["Animal Class"] = "Rat";
                      } else if (d["Species Description"].includes("Squirrel")) {
                          d["Animal Class"] = "Squirrel";
                      } else if (d["Species Description"].includes("Raccoon")) {
                          d["Animal Class"] = "Raccoon";
                      }
                  }
              });

        clean_data = data.filter(d => {
              return d["# of Animals"] >= 1 && d["# of Animals"] <= 20;
              });
        
        console.log("Filtered Data:", clean_data);

        
        //Scale creations

        const boroughs = Array.from(new Set(clean_data.map(d => d['Borough'])));
        const xScale = d3.scaleBand().domain(boroughs).range([0,chartWidth]).padding(0.1);
   
        const animalExtent = d3.extent(clean_data, d => d['# of Animals']);
        const yScale = d3.scaleLinear().domain(animalExtent).range([chartHeight, 0]);

        //Creating the x-axis and y-axis, and gridlines

        //x-axis
        let bottomAxis = d3.axisBottom(xScale)
        let bottomGridlines = d3.axisBottom(xScale)
                                .tickSize(-chartHeight-10)
                                .tickFormat("")
                    annotations.append("g")
                    .attr("class", "x axis")
                    .attr("transform",`translate(${margin.left},${chartHeight+margin.top+10})`)
                    .call(bottomAxis);
                    
                    annotations.append("g")
                    .attr("class", "x gridlines")
                    .attr("transform",`translate(${margin.left},${chartHeight+margin.top+10})`)
                    .call(bottomGridlines);

        //y-axis
        let leftAxis = d3.axisLeft(yScale)
        let leftGridlines = d3.axisLeft(yScale)
                              .tickSize(-chartWidth-10)
                              .tickFormat("")
                    
          annotations.append("g")
                              .attr("class", "y axis")
                              .attr("transform",`translate(${margin.left-10},${margin.top})`)
                              .call(leftAxis)
          annotations.append("g")
                              .attr("class", "y gridlines")
                              .attr("transform",`translate(${margin.left-10},${margin.top})`)
                              .call(leftGridlines);

          const data_images = {
              "Rabbit": "images/rabbit.png",
              "Cat": "images/cat.png",
              "Dog": "images/dog.png",
              "Raptors": "images/hawk-bird-animal-shape.png",
              "Fish-numerous quantity": "images/fish.png",
              "Frog": "images/frog.png",
              "Turtle": "images/turtle.png",
              "Snake": "images/snake.png",
              "Raccoon": "images/raccoon.png",
              "Rat": "images/rat.png",
              "Mouse": "images/mouse.png",
              "Squirrel": "images/squirrel.png",
              "Bat": "images/bat.png",
              "Deer": "images/deer.png",
              "Birds": "images/hummingbird.png"
          };

          // Add jitter function
          const jitter = () => Math.random() * xScale.bandwidth() * 0.8;

          chartArea.selectAll("image").data(clean_data)
                              .join("image")
                              .attr("xlink:href", d=> data_images[d['Animal Class']])
                              .attr("opacity", 0.7)
                              .attr("width", 15)
                              .attr("height", 15)
                              .attr("x", d => xScale(d['Borough']) + jitter())
                              .attr("y", d => yScale(d['# of Animals']));

          // Add x-axis label
          svg.append("text")
             .attr("class", "axis-label")
             .attr("x", width / 2)
             .attr("y", height - 10)
             .style("text-anchor", "middle")
             .text("Borough");

          // Add y-axis label
          svg.append("text")
             .attr("class", "axis-label")
             .attr("transform", "rotate(-90)")
             .attr("x", -height / 2)
             .attr("y", 15)
             .style("text-anchor", "middle")
             .text("Number of Animals at the call");

          // Add chart title
          svg.append("text")
             .attr("class", "chart-title")
             .attr("x", width / 2)
             .attr("y", 25)
             .style("text-anchor", "middle")
             .text("Animal Rescues by Borough in NYC");

        });


    </script>
    </p> 
</body>