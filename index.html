<!DOCTYPE html>
<html lang="en">

<head>
    <title>INFO 5100 - Project 1 </title>
    <ul>
        <li>
            Jillian Beck - JLB574
        </li>
        <li>
            Hung Ming Tseng - ht495
        </li>
        <li>
            Peipei Duan - pd439
        </li>
    </ul>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <style>
        .legend span {
            margin-right: 10px;
        }

        .gridlines line {
            stroke: #bbb;
        }

        .gridlines .domain {
            stroke: none;
        }

        .borough {
            stroke: grey;
            stroke-width: 0.2;
        }

        .legend-text {
            font-size: 10px;
        }

        p {
          text-align: center;
          padding: 10px;
          justify-content: center;
        }

        h1 {
          text-align: center;
        }

        h2 {
          text-align: center;
        }


    </style>

</head>

<body>

    <h1> Project Topic</h1>
    <p> For our project, we used a government data set from the Department of Parks and Recreation, sourced from NYC Open Data, that includes Urban Park Ranger calls for animal rescues from 2018-2024. Using this data, we investigated the relationship between New York City's five boroughs and their amount of animal calls. We hypothesized that there would be a similar amount of calls across each borough, and that the most frequent animal in the call would be a rodent, such as mice or rats.  </p>

    <p>

      <h2> Visualization One: Scatter Plot</h2>
      <p> Animal Calls across Boroughs with the Number of Animals at the Scene and Their Respective Species <p>
        <svg id="graph" height="800" width="1100" style="margin-top:50px"> </svg>

        <script>
            d3.csv("Urban_Park_Ranger_Animal_Condition_Response_20241001.csv", d3.autoType)
                .then((data) => {
                    console.log(data);

                    const svg = d3.select("#graph");
                    const width = svg.attr("width");
                    const height = svg.attr("height");
                    const margin = { top: 50, right: 50, bottom: 70, left: 70 };
                    const chartWidth = width - margin.left - margin.right;
                    const chartHeight = height - margin.top - margin.bottom;
                    const graph = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                    const species = ["Birds", "Deer", "Bat", "Rat", "Squirrel", "Mouse", "Raccoon", "Snake", "Turtle", "Frog", "Fish-numerous quantity", "Raptors", "Dog", "Cat", "Rabbit"];


                    let annotations = svg.append("g").attr("id", "annotations");
                    let chartArea = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);


                    data.forEach(d => {
                        if (d["Animal Class"] === "Domestic") { //since the "Animal Class" column lumps cats, dogs,  and rabbits under "Domestic," here we're filtering through the data to seperate these animals into their own animal class categories
                            if (d["Species Description"].includes("Rabbit")) {
                                d["Animal Class"] = "Rabbit";
                            } else if (d["Species Description"].includes("Cat")) {
                                d["Animal Class"] = "Cat";
                            } else if (d["Species Description"].includes("Dog")) {
                                d["Animal Class"] = "Dog";
                            }
                        }
                    });


                    data.forEach(d => {
                        if (d["Animal Class"] === "Terrestrial Reptile or Amphibian") {
                            if (d["Species Description"].includes("Snake")) {
                                d["Animal Class"] = "Snake";
                            } else if (d["Species Description"].includes("Turtle")) {
                                d["Animal Class"] = "Turtle";
                            } else if (d["Species Description"].includes("Frog")) {
                                d["Animal Class"] = "Frog";
                            }
                        }
                    });

                    data.forEach(d => {
                        if (d["Animal Class"] === "Small Mammals - RVS") { //RVS denotes animals that were called in as having rabies, the "Non-RVS" category is for those same species but for calls without rabies. 
                            if (d["Species Description"].includes("Bat")) {
                                d["Animal Class"] = "Bat";
                            } else if (d["Species Description"].includes("Mouse")) {
                                d["Animal Class"] = "Mouse";
                            } else if (d["Species Description"].includes("Rat")) {
                                d["Animal Class"] = "Rat";
                            } else if (d["Species Description"].includes("Squirrel")) {
                                d["Animal Class"] = "Squirrel";
                            } else if (d["Species Description"].includes("Raccoon")) {
                                d["Animal Class"] = "Raccoon";
                            }
                        }
                    });

                    data.forEach(d => {
                        if (d["Animal Class"] === "Small Mammals - non RVS") { //logging non RVS species to be clumped in same category of RVS 
                            if (d["Species Description"].includes("Bat")) {
                                d["Animal Class"] = "Bat";
                            } else if (d["Species Description"].includes("Mouse")) {
                                d["Animal Class"] = "Mouse";
                            } else if (d["Species Description"].includes("Rat")) {
                                d["Animal Class"] = "Rat";
                            } else if (d["Species Description"].includes("Squirrel")) {
                                d["Animal Class"] = "Squirrel";
                            } else if (d["Species Description"].includes("Raccoon")) {
                                d["Animal Class"] = "Raccoon";
                            }
                        }
                    });

                    clean_data = data.filter(d => {
                        return d["# of Animals"] >= 2 && d["# of Animals"] <= 30;
                    });

                    console.log("Filtered Data:", clean_data);


                    //Scale creations

                    const boroughs = Array.from(new Set(clean_data.map(d => d['Borough'])));
                    const xScale = d3.scaleBand().domain(boroughs).range([0, chartWidth]);

                    const animalExtent = d3.extent(clean_data, d => d['# of Animals']);
                    const yScale = d3.scaleLog().domain(animalExtent).range([chartHeight, 0]);

                    //Creating the x-axis and y-axis, and gridlines

                    //x-axis
                    let bottomAxis = d3.axisBottom(xScale)
                    let bottomGridlines = d3.axisBottom(xScale)
                        .tickSize(-chartHeight - 10)
                        .tickFormat("")
                    annotations.append("g")
                        .attr("class", "x axis")
                        .attr("transform", `translate(${margin.left},${chartHeight + margin.top + 10})`)
                        .call(bottomAxis);

                    annotations.append("g")
                        .attr("class", "x gridlines")
                        .attr("transform", `translate(${margin.left},${chartHeight + margin.top + 10})`)
                        .call(bottomGridlines);

                    //y-axis
                    let leftAxis = d3.axisLeft(yScale)
                    let leftGridlines = d3.axisLeft(yScale)
                        .tickSize(-chartWidth - 10)
                        .tickFormat("")

                    annotations.append("g")
                        .attr("class", "y axis")
                        .attr("transform", `translate(${margin.left - 10},${margin.top})`)
                        .call(leftAxis)
                    annotations.append("g")
                        .attr("class", "y gridlines")
                        .attr("transform", `translate(${margin.left - 10},${margin.top})`)
                        .call(leftGridlines);

                    const data_images = {
                        "Rabbit": "images/rabbit.png", // <a href="https://www.flaticon.com/free-icons/rabbit" title="rabbit icons">Rabbit icons created by PLANBSTUDIO - Flaticon</a>
                        "Cat": "images/cat.png", //<a href="https://www.flaticon.com/free-icons/black-cat" title="black cat icons">Black cat icons created by PLANBSTUDIO - Flaticon</a>
                        "Dog": "images/dog.png", //<a href="https://www.flaticon.com/free-icons/dog" title="dog icons">Dog icons created by PLANBSTUDIO - Flaticon</a>
                        "Raptors": "images/hawk-bird-animal-shape.png", //<a href="https://www.flaticon.com/free-icons/hawk" title="hawk icons">Hawk icons created by Freepik - Flaticon</a>
                        "Fish-numerous quantity": "images/fish.png", //<a href="https://www.flaticon.com/free-icons/fish" title="fish icons">Fish icons created by Freepik - Flaticon</a>
                        "Frog": "images/frog.png", //<a href="https://www.flaticon.com/free-icons/frog" title="frog icons">Frog icons created by Mihimihi - Flaticon</a>
                        "Turtle": "images/turtle.png", //<a href="https://www.flaticon.com/free-icons/turtle" title="turtle icons">Turtle icons created by PLANBSTUDIO - Flaticon</a>
                        "Snake": "images/snake.png", //<a href="https://www.flaticon.com/free-icons/serpent" title="serpent icons">Serpent icons created by Unknown Depths - Flaticon</a>
                        "Raccoon": "images/raccoon.png", //<a href="https://www.flaticon.com/free-icons/raccoon" title="raccoon icons">Raccoon icons created by Icongeek26 - Flaticon </a>
                        "Rat": "images/rat.png", //<a href="https://www.flaticon.com/free-icons/rat" title="rat icons">Rat icons created by Vector Stall - Flaticon</a>
                        "Mouse": "images/mouse.png", //<a href="https://www.flaticon.com/free-icons/rat" title="rat icons">Rat icons created by G-CAT - Flaticon</a>
                        "Squirrel": "images/squirrel.png", //<a href="https://www.flaticon.com/free-icons/squirrel" title="squirrel icons">Squirrel icons created by PLANBSTUDIO - Flaticon</a>
                        "Bat": "images/bat.png", // <a href="https://www.flaticon.com/free-icons/bat" title="bat icons">Bat icons created by Freepik - Flaticon</a>
                        "Deer": "images/deer.png", //<a href="https://www.flaticon.com/free-icons/deer" title="deer icons">Deer icons created by Freepik - Flaticon</a>
                        "Birds": "images/hummingbird.png" // <a href="https://www.flaticon.com/free-icons/bird" title="bird icons">Bird icons created by Freepik - Flaticon</a>
                    };


                     const colorScale = d3.scaleOrdinal()
                                  .domain(boroughs)
                                  .range(['#fdcc8a', '#fef0d9', '#fc8d59', '#b30000', '#e34a33']); 

                     chartArea.selectAll("rect")
                                  .data(boroughs)
                                  .join("rect")
                                  .attr("x", d => xScale(d))
                                  .attr("y", 0)
                                  .attr("width", xScale.bandwidth())
                                  .attr("height", chartHeight)
                                  .attr("fill",d => colorScale(d))
                                  .attr("opacity", 0.2);

                    const jitter = () => Math.random() * xScale.bandwidth() * 0.8;

                    chartArea.selectAll("image").data(clean_data)
                        .join("image")
                        .attr("r", 4)
                        .attr("xlink:href", d => data_images[d['Animal Class']])   // using attr here, style would work too
                        .attr("opacity", 0.7)
                        .attr("width", 15)
                        .attr("height", 15)
                        .attr("x", d => xScale(d['Borough'])+ jitter())
                        .attr("y", d => yScale(d['# of Animals']));


                       // Add x-axis label
                        svg.append("text")
                          .attr("class", "axis-label")
                          .attr("x", width / 2)
                          .attr("y", height - 10)
                          .style("text-anchor", "middle")
                          .text("Borough");

                        // Add y-axis label
                        svg.append("text")
                          .attr("class", "axis-label")
                          .attr("transform", "rotate(-90)")
                          .attr("x", -height / 2)
                          .attr("y", 15)
                          .style("text-anchor", "middle")
                          .text("Number of Animals at the call");

                        // Add chart title
                        svg.append("text")
                          .attr("class", "chart-title")
                          .attr("x", width / 2)
                          .attr("y", 25)
                          .style("text-anchor", "middle")
                          .text("Animal Rescues by Borough in NYC");

                });


        </script>
    </p>

    <h2> Vizualization Two: Map </h2>
    <p> This map illustrates the total number of animals rescued in each borough.
        <br>
        We can see Manhattan has the highest number,
        then Staten Island, Queens, Brooklyn, and lastly Bronx.
    </p>
    <p>
        <svg id="map" height="800" width="1100"></svg>
        <svg id="legend" width="200" height="450"></svg>

        <script>
            const svg = d3.select("#map");
            const width = +svg.attr("width");
            const height = +svg.attr("height");

            const projection = d3.geoMercator()
                .scale(65000)
                .center([-74.0060, 40.7128])
                .translate([width / 2, height / 2]);

            const path = d3.geoPath().projection(projection);

            d3.json("merged_borough.geojson").then(data => {
                const counts = data.features.map(feature => feature.properties['# of Animals'] || 0);

                const colorScale = d3.scaleQuantile()
                    .domain(counts)
                    .range(["#fef0d9", "#fdcc8a", "#fc8d59", "#e34a33", "#b30000"]);

                svg.selectAll(".borough")
                    .data(data.features)
                    .join("path")
                    .attr("class", "borough")
                    .attr("d", path)
                    .attr("fill", d => {
                        const count = d.properties['# of Animals'] || 0;
                        return colorScale(count);
                    });

                svg.selectAll(".borough-label")
                    .data(data.features)
                    .join("text")
                    .attr("class", "borough-label")
                    .attr("x", d => path.centroid(d)[0])
                    .attr("y", d => path.centroid(d)[1])
                    .attr("dy", ".35em")
                    .attr("text-anchor", "middle")
                    .style("font-size", "12px")
                    .style("fill", "black")
                    .style("font-weight", "bold")
                    .text(d => d.properties.Borough);

                const legend = d3.select("#legend"),
                    legendWidth = +legend.attr("width"),
                    legendHeight = +legend.attr("height");

                const quantileLabels = colorScale.quantiles();
                const legendLabels = [0].concat(quantileLabels);
                const rectHeight = legendHeight / legendLabels.length;

                legend.selectAll("rect")
                    .data(legendLabels)
                    .join("rect")
                    .attr("x", 10)
                    .attr("y", (d, i) => i * rectHeight)
                    .attr("width", 20)
                    .attr("height", rectHeight)
                    .attr("fill", d => colorScale(d));

                legend.selectAll(".legend-text")
                    .data(legendLabels)
                    .join("text")
                    .attr("class", "legend-text")
                    .attr("x", 40)
                    .attr("y", (d, i) => (i + 0.5) * (legendHeight / legendLabels.length) - 36)
                    .text(d => Math.round(d));


                  // Add chart title
                  svg.append("text")
                    .attr("class", "chart-title")
                    .attr("x", width / 2)
                    .attr("y", 780)
                    .style("text-anchor", "middle")
                    .text("Map of NYC Boroughs by Counts of Animal Rescues");

            });
        </script>










    </p>







</body>